// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://@sbaseurl@/jsapi/jsapi/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"widgets/AttributeTable/utils":function(){define("dojo/_base/lang dojo/_base/array jimu/LayerInfos/LayerInfos dojo/Deferred dojo/promise/all exports dojo/store/Observable dojo/store/Cache dojo/store/Memory esri/lang ./table/FeatureLayerQueryStore jimu/ArcadeUtils jimu/utils esri/graphic".split(" "),function(f,n,u,r,h,b,k,x,y,w,g,a,q,e){function v(d,a){if(!d||!d.length)return a||[];if(!a||!a.length)return d;for(var c=[],l=0,m=d.length;l<m;l++)for(var t=d[l],p=0,e=a.length;p<e;p++){var q=
a[p];if(q.name===t.name){q.alias!==t.alias&&(t.alias=q.alias);c.push(t);break}}return c}b.readLayerInfosObj=function(a){return u.getInstance(a,a.itemInfo)};b.readLayerInfosFromMap=function(a,p,c){var l=new r;u.getInstance(a,a.itemInfo).then(f.hitch(this,function(a){var d=[];p?a.traversalLayerInfosOfWebmap(function(a){d.push(a)}):a.traversal(function(a){d.push(a)});if(c){var m=[],e=a.getMapNotesLayerInfoArray();n.forEach(e,function(a){m.push(a.id);a.traversal(function(a){m.push(a.id)})});d=n.filter(d,
function(a){return-1===m.indexOf(a.id)})}a=a.getTableInfoArray();d=d.concat(a);l.resolve(d)}),f.hitch(this,function(a){console.error(a);l.reject(a)}));return l.promise};b.generateColumnsFromFields=function(a,p,c,l,e,t,z,g){function d(a){if(m&&w.isDefined(m.fieldInfos))for(var c=0,l=m.fieldInfos.length;c<l;c++){var d=m.fieldInfos[c];if(d.fieldName===a)return d.format}return null}var m=p.getPopupInfo(),v={selectionHandle:{label:"",className:"selection-handle-column",hidden:!1,unhidable:!0,filed:"selection-handle-column",
sortable:!1,_cache:{sortable:!1,statistics:!1}}};n.forEach(c,f.hitch(b,function(c,m,k){m="field"+m;var h=!!c.domain,y="esriFieldTypeDate"===c.type,A=l&&c.name===l,x="esriFieldTypeDouble"===c.type||"esriFieldTypeSingle"===c.type||"esriFieldTypeInteger"===c.type||"esriFieldTypeSmallInteger"===c.type,C="esriFieldTypeString"===c.type,B=0===c.name.indexOf("expression/"),r=c.alias||c.name,u;u=1===k.length?!1:a&&a[m]?a[m].hidden:c?!c.show&&w.isDefined(c.show):!1;v[m]={label:r,className:m,hidden:u,unhidable:1===
k.length?!1:!c.show&&w.isDefined(c.show)&&c._pk,field:c.name,sortable:!1,_cache:{sortable:!!t,statistics:z&&!h&&x}};C?v[m].formatter=f.hitch(b,b.urlFormatter):y?v[m].formatter=f.hitch(b,b.dateFormatter,d(c.name)):x&&(v[m].formatter=f.hitch(b,b.numberFormatter,d(c.name)));h?v[m].get=f.hitch(b,function(c,a,d){return this.getCodeValue(c,a.name,d)},g,c):A?v[m].get=f.hitch(b,function(c,a,d){return this.getTypeName(d[c.name],a)},c,e):B?(k=this.arcade.getExpressionInfosFromLayerInfo(p),h=q.getFeatureLayerDefinition(g),
v[m]._cache.sortable=!1,v[m].get=f.hitch(b,function(c,a,d,l){return this.arcade.getAttributes(l,c,d)[a.name]||""},k,c,h)):h||y||A||B||(v[m].get=f.hitch(b,function(c,a,d,l,m){var t=null;d&&l&&0<l.length&&(l=(l=n.filter(l,f.hitch(b,function(c){return c.id===m[d]})))&&l[0]||null)&&l.domains&&l.domains[a.name]&&l.domains[a.name].codedValues&&(t=this.getCodeValue(c,a.name,m));return(c=null!==t?t:m[a.name])||isFinite(c)?c:""},g,c,l,e))}));return v};b.getTypeName=function(a,p){return q.fieldFormatter.getTypeName(a,
p)};b.getCodeValue=function(a,p,c){return(a=q.getDisplayValueForCodedValueOrSubtype(a,p,c))&&a.isCodedValueOrSubtype?a.displayValue||"":""};b.urlFormatter=function(a){return q.fieldFormatter.getFormattedUrl(a)};b.dateFormatter=function(a,p){return q.fieldFormatter.getFormattedDate(p,a)};b.numberFormatter=function(a,p){return q.fieldFormatter.getFormattedNumber(p,a)};b.readLayerObjectsFromMap=function(a,p,c){var l=new r,d=[];this.readLayerInfosFromMap(a,p,c).then(f.hitch(this,function(a){n.forEach(a,
f.hitch(this,function(a){d.push(a.getLayerObject())}));h(d).then(f.hitch(this,function(a){l.resolve(a)}),f.hitch(this,function(a){l.reject(a);console.error(a)}))}),f.hitch(this,function(a){l.reject(a)}));return l.promise};b.readSupportTableInfoFromLayerInfos=function(a){var d=new r,c=[];n.forEach(a,f.hitch(this,function(a){c.push(a.getSupportTableInfo())}));h(c).then(f.hitch(this,function(c){c=f.clone(c);n.forEach(c,function(c,l){c.id=a[l].id});d.resolve(c)}),function(a){d.reject(a)});return d.promise};
b.readConfigLayerInfosFromMap=function(a,e,c){var l=new r,d=[];this.readLayerInfosFromMap(a,e,c).then(f.hitch(this,function(a){var c=[];n.forEach(a,function(a){d.push(a.getSupportTableInfo())});h(d).then(f.hitch(this,function(d){n.forEach(d,f.hitch(this,function(l,d){l.isSupportedLayer&&(a[d].name=a[d].title,c.push(a[d]))}));l.resolve(c)}),f.hitch(this,function(a){l.reject(a)}))}),f.hitch(this,function(a){l.reject(a)}));return l.promise};b.getConfigInfosFromLayerInfos=function(a){return n.map(a,function(a){return b.getConfigInfoFromLayerInfo(a)})};
b.getConfigInfoFromLayerInfo=function(a){var d={};d.name=a.name||a.title;d.id=a.id;d.show=a.isShowInMap();d.layer={url:a.getUrl()};var c=a.getPopupInfo();c&&!c.description&&(d.layer.fields=n.map(c.fieldInfos,function(a){return{name:a.fieldName,alias:a.label,show:a.visible,format:a.format}}),a=f.getObject("layerObject.fields",!1,a),d.layer.fields=v(d.layer.fields,a),n.some(d.layer.fields,function(a){return a.show})||(d.layer.fields&&0<d.layer.fields.length?d.layer.fields[0].show=!0:console.warn("We do not get fields info.")));
return d};b.generateCacheStore=function(a,e,c,l,m){a=new g({layer:a,objectIds:a._objectIds||null,totalCount:e,batchCount:c,where:l||"1\x3d1",spatialFilter:m});e=new y;return new x(a,e,{})};b.generateMemoryStore=function(a,e){return new k(new y({data:a||[],idProperty:e}))};b.merge=function(a,e,c,l){for(var d=n.map(e,function(a){return a[c]}),t=0,q=a.length;t<q;t++){var v=d.indexOf(a[t][c]);-1<v&&l(a[t],e[v])}};b.syncOrderWith=function(a,e,c){function l(a,c){return n.map(a,function(a){return a[c]})}
if(!f.isArray(e)||!c)return a;for(var d=l(a,c),t=[],q=0,v=e.length;q<v;q++){var g=d.indexOf(e[q][c]);-1<g&&(t=t.concat(a.splice(g,1)),d=l(a,c))}return t.concat(a)};b.arcade={};b.arcade.getExpressionInfosFromLayer=function(d,e){d=a.readExprInfo.getArcadeProfilesByType(d,e,"infoTemplate");return 0<d.length&&d[0].expressionInfos?d[0].expressionInfos:[]};b.arcade.getExpressionInfosFromLayerInfo=function(a){return(a=a&&a.getPopupInfo())&&a.expressionInfos||[]};b.arcade.getAttributes=function(d,q,c){var l=
new e(d.geometry,null,d);return a.customExpr.getAttributesFromCustomArcadeExpr(q,l,c)||d};b.arcade.appendArcadeExpressionsToFields=function(a,e){e=b.arcade.getExpressionInfosFromLayerInfo(e);if(0<e.length){var c=/^expression\//;n.forEach(e,function(l){n.some(a,function(a){if(c.test(a.name))return a=a.name.substr(11),l.name===a})||a.push({name:"expression/"+l.name,alias:l.title,show:!0})})}return a};b.arcade.isArcadeExpressionField=function(a){return a&&"string"===typeof a.name&&0===a.name.indexOf("expression/")};
b.arcade.parseArcadeExpressions=function(e){return a.InfoTemplate._parseArcadeExpressions(e)};b.getSortbyFields=function(a,e){a=a&&a.get("sort")||[];e=e&&e.objectIdField;0<a.length?a=n.map(a,function(a){return a.attribute+" "+(a.descending?"DESC":"ASC")}):e&&a.push(e+" ASC");return a}})},"dojo/store/Cache":function(){define(["../_base/lang","../when"],function(f,n){var u=function(r,h,b){b=b||{};return f.delegate(r,{query:function(k,f){k=r.query(k,f);k.forEach(function(k){b.isLoaded&&!b.isLoaded(k)||
h.put(k)});return k},queryEngine:r.queryEngine||h.queryEngine,get:function(k,b){return n(h.get(k),function(f){return f||n(r.get(k,b),function(b){b&&h.put(b,{id:k});return b})})},add:function(k,b){return n(r.add(k,b),function(f){h.add(f&&"object"==typeof f?f:k,b);return f})},put:function(b,f){h.remove(f&&f.id||this.getIdentity(b));return n(r.put(b,f),function(k){h.put(k&&"object"==typeof k?k:b,f);return k})},remove:function(b,f){return n(r.remove(b,f),function(k){return h.remove(b,f)})},evict:function(b){return h.remove(b)}})};
f.setObject("dojo.store.Cache",u);return u})},"widgets/AttributeTable/table/FeatureLayerQueryStore":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array esri/tasks/query esri/tasks/QueryTask ./FeatureLayerQueryResult".split(" "),function(f,n,u,r,h,b){return f(null,{queryUrl:"",idProperty:"id",data:null,_entityData:null,constructor:function(b){f.safeMixin(this,b);this.data=[];this._entityData=[];this.layer=b.layer;this.objectIds=b.objectIds;this.where=b.where;this.orderByFields=b.orderByFields;
this.totalCount=b.totalCount;this.batchCount=b.batchCount||25;this.idProperty=this.layer.objectIdField;this.spatialFilter=b.spatialFilter;this.layer&&this.layer.url&&(this.queryTask=new h(this.layer.url))},get:function(b){return this.data[b]},getIdentity:function(b){return b[this.idProperty]},query:function(f,h){var k=new r,w=h&&h.start||0,g=h._export_count||this.batchCount,a=null;"function"===typeof f?a=f(this._entityData):"[object Array]"===Object.prototype.toString.call(f)&&(a=f);this.objectIds?
(a=a?a:this.objectIds,k.objectIds=a.length>=w+this.batchCount?a.slice(w,w+g):a.slice(w)):(a&&0<a.length?k.objectIds=a.length>=w+this.batchCount?a.slice(w,w+g):a.slice(w):(k.start=w,k.num=g,k.where=this.where,k.geometry=this.spatialFilter,k.spatialRelationship=r.SPATIAL_REL_INTERSECTS),(f=h.sort)&&0<f.length&&(f=u.map(f,function(a){return a.attribute+" "+(a.descending?"DESC":"ASC")}),k.orderByFields=f));k.returnGeometry="esriGeometryPoint"===this.layer.geometryType;k.outFields=["*"];var q=this.totalCount;
f=null;f=!k.where;if(!(k.objectIds&&0<k.objectIds.length)&&f)return new b([]);f=this.queryTask?this.queryTask.execute(k):this.layer.queryFeatures(k);f.total=f.then(n.hitch(this,function(a){var e=0,d=this.layer.objectIdField;if(this.objectIds){if(!d)for(e=0;e<a.fields.length;e++)if("esriFieldTypeOID"===a.fields[e].type){d=a.fields[e].name;break}for(var b={},e=0;e<a.features.length;e++)b[a.features[e].attributes[d]]=a.features[e];a.features=u.map(k.objectIds,function(a){return b[a]})}for(e=0;e<a.features.length;e++)if(a.features[e]){var c=
a.features[e];a.features[e]=n.mixin(n.clone(c.attributes),{geometry:c.geometry});this.data[a.features[e][d]]=a.features[e];this._entityData.push(a.features[e])}a=a.features;return q}),function(){console.log("FeatureLayerQueryStore queryFeatures failed.");return 0});return new b(f)}})})},"widgets/AttributeTable/table/FeatureLayerQueryResult":function(){define("esri/main dojo/_base/lang dojo/_base/kernel dojo/_base/Deferred dojo/DeferredList dojo/_base/array".split(" "),function(f,n,u,r){var h=function(b){function k(f){b[f]||
(b[f]=function(){var k=arguments;return r.when(b,function(b){Array.prototype.unshift.call(k,b.features||b);return h(u[f].apply(u,k))})})}if(!b)return b;b.then&&(b=n.delegate(b));b.total||(b.total=r.when(b,function(b){return f._isDefined(b.total)?b.total:b.length||0}));k("forEach");k("filter");k("map");k("some");k("every");return b};return h})},"jimu/ArcadeUtils":function(){define("dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/string esri/arcade/arcade esri/arcade/Feature esri/tasks/RelationshipQuery jimu/utils jimu/LayerStructure".split(" "),
function(f,n,u,r,h,b,k,x,y,w){var g={readExprInfo:{}};g.readExprInfo.getArcadeProfilesByType=function(a,b,e){a={map:a,layer:b};return"render"===e?g.readExprInfo._getArcadeRender(a):"label"===e?g.readExprInfo._getArcadeLabel(a):"infoTemplate"===e?g.readExprInfo._getArcadeInfoTemplate(a):g.readExprInfo._getAllArcade(a)};g.readExprInfo._getArcadeRender=function(a){return g.readExprInfo._lookupArcadeRender({layers:g.readExprInfo._checkPassInLayer(a)})};g.readExprInfo._getArcadeInfoTemplate=function(a){return g.readExprInfo._lookupArcadeInfoTemplate({layers:g.readExprInfo._checkPassInLayer(a)})};
g.readExprInfo._getArcadeLabel=function(a){return g.readExprInfo._lookupArcadeLabel({layers:g.readExprInfo._checkPassInLayer(a)})};g.readExprInfo._getAllArcade=function(a){var b=g.readExprInfo._getArcadeRender(a),e=g.readExprInfo._getArcadeInfoTemplate(a);a=g.readExprInfo._getArcadeLabel(a);return{render:b,infoTemplate:e,label:a}};g.readExprInfo._checkPassInLayer=function(a){var b=[];return b="undefined"!==typeof a?"undefined"!==typeof a.layer?null!==a.layer&&""!==a.layer?g.readExprInfo._getAllMapLayers(a):
g.readExprInfo._getAllMapLayers():g.readExprInfo._getAllMapLayers():g.readExprInfo._getAllMapLayers()};g.readExprInfo._getAllMapLayers=function(a){var b="",e=[],f=w.getInstance();a&&a.layer&&(b=a.layer.id);""!==b?(a=f.getNodeById(b))&&e.push(a._layerInfo.layerObject):f.traversal(function(a){"undefined"!==typeof a._layerInfo.layerObject.type?-1===a._layerInfo.layerObject.type.indexOf("tile")&&e.push(a._layerInfo.layerObject):e.push(a._layerInfo.layerObject)});return e};g.readExprInfo._lookupArcadeRender=
function(a){var b=[];0<a.layers.length&&f.forEach(a.layers,n.hitch(this,function(a){var e={};if("undefined"!==typeof a.renderer){var d=a.renderer;"undefined"!==typeof d.valueExpression&&(e.layer=a.id,e.valueExpression=d.valueExpression,e.valueExpressionTitle=d.valueExpressionTitle,"undefined"!==typeof d.values&&(e.values=d.values),"undefined"!==typeof d.visualVariables&&(e.visualVariables=d.visualVariables));1<Object.keys(e).length&&e.constructor===Object?b.push(e):b.push({layer:a.id,valueExpression:null,
valueExpressionTitle:null,values:null,visualVariables:null})}}));return b};g.readExprInfo._lookupArcadeInfoTemplate=function(a){var b=[];0<a.layers.length&&f.forEach(a.layers,n.hitch(this,function(a){var e={};if("undefined"!==typeof a.infoTemplate)"undefined"!==typeof a.infoTemplate.info.expressionInfos&&0<a.infoTemplate.info.expressionInfos.length&&(e.layer=a.id,e.expressionInfos=a.infoTemplate.info.expressionInfos);else if("undefined"!==typeof a.infoTemplates)for(var d in a.infoTemplates)if(a.infoTemplates.hasOwnProperty(d)&&
"undefined"!==typeof a.infoTemplates[d].infoTemplate.info.expressionInfos){var f=a.infoTemplates[d].infoTemplate;0<f.info.expressionInfos.length&&(e.layer=a.id,e.expressionInfos=f.info.expressionInfos)}1<Object.keys(e).length&&e.constructor===Object?b.push(e):b.push({layer:a.id,expressionInfos:null})}));return b};g.readExprInfo._lookupArcadeLabel=function(a){var b=[];0<a.layers.length&&f.forEach(a.layers,n.hitch(this,function(a){var e={};"undefined"!==typeof a.labelingInfo&&f.forEach(a.labelingInfo,
n.hitch(this,function(b){"undefined"!==typeof b.name&&(e.layer=a.id,e.name=b.name,e.labelingInfo=b,e.expression=b.labelExpressionInfo.expression)}));1<Object.keys(e).length&&e.constructor===Object?b.push(e):b.push({layer:a.id,name:null,labelingInfo:null,expression:null})}));return b};g.customExpr={};g.customExpr.getAttributesFromCustomArcadeExpr=function(a,b,e){a=g.InfoTemplate._parseArcadeExpressions(a);return g.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(b,a,e)};g.customExpr.getAttributesValueFromCustomArcadeExprBatch=
function(a,b,e){var f=[],d;for(d in b)f.push(b[d]);b=g.InfoTemplate._parseArcadeExpressions(a);a=g.InfoTemplate._getExprNamesArrayFromPopupExprInfos(a);a.relationships=null;a.parsedExpressions=b;var q=new u;g.InfoTemplate._getPopupFieldsValueFromArcadeFeatures(f,a,e).then(function(a){q.resolve(a)});return q};g.InfoTemplate={};g.InfoTemplate.getAttributesFromInfoTemplate=function(a,b,e){var f={fields:[]};b.layerObject&&b.layerObject.fields&&(f.fields=b.layerObject.fields);a=g.readExprInfo.getArcadeProfilesByType(a,
b,"infoTemplate")[0].expressionInfos;if(!a)return e.attributes;a=g.InfoTemplate._parseArcadeExpressions(a);return g.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(e,a,f)};g.InfoTemplate.getAttributesValueFromInfoTemplateBatch=function(a,b,e){var f={fields:[]};b.layerObject&&b.layerObject.fields&&(f.fields=b.layerObject.fields);var d=[],h;for(h in e)d.push(e[h]);a=g.readExprInfo.getArcadeProfilesByType(a,b,"infoTemplate")[0].expressionInfos;var c=new u;if(!a)return c.resolve([]),c;
e=g.InfoTemplate._parseArcadeExpressions(a);h=null;h=b.getPopupInfo().description;null!==h?(h=g.InfoTemplate._convertPopupDescToFieldNamesArray(h),h.relationships=g.InfoTemplate._getRelationshipQueries(b)):(h=g.InfoTemplate._getExprNamesArrayFromPopupExprInfos(a),h.relationships=null);h.parsedExpressions=e;g.InfoTemplate._getPopupFieldsValueFromArcadeFeatures(d,h,f).then(function(a){c.resolve(a)});return c};g.InfoTemplate._getRelationshipQueries=function(a){var b=!1,e={},g=/\d+/,d;if(d=a.getPopupInfo().description.match(/\{relationships\/\d+\//gm))b=
!0,f.forEach(d,function(b){var c=b.match(g)[0];e.hasOwnProperty(c)||(b=new x,b.outFields=["*"],b.relationshipId=c,b.returnGeometry=!1,e[c]={operLayer:a,relatedQuery:b})});return b?e:null};g.InfoTemplate._getExprNamesArrayFromPopupExprInfos=function(a){var b=[],e;for(e in a)b.push("${expression/"+a[e].name+"}");return b};g.InfoTemplate._convertPopupDescToFieldNamesArray=function(a){a=g.InfoTemplate._convertEndParasToEOLs(a);a=g.InfoTemplate._convertBreaksToEOLs(a);a=g.InfoTemplate._sanitizeNoTags(a).trim();
a=a.replace(/\{/gi,"${");a=a.replace(/\u00a0/gi," ");a=a.split("\n");return a=f.map(a,function(a){return a.trim()})};g.InfoTemplate._sanitizeNoTags=function(a){var b;b=y.sanitizeHTML(a);a=/<(?:!--(?:(?:-*[^->])*--+|-?)|script\b(?:[^"'>]|"[^"]*"|'[^']*')*>[\s\S]*?<\/script\s*|style\b(?:[^"'>]|"[^"]*"|'[^']*')*>[\s\S]*?<\/style\s*|\/?[a-z](?:[^"'>]|"[^"]*"|'[^']*')*)>/gi;var e;do e=b,b=b.replace(a,"");while(b!==e);return b=b.replace(/</g,"\x26lt;")};g.InfoTemplate._getPopupFieldsValueFromArcadeFeatures=
function(a,b,e){var k=new u,d=[],q=[],c=0;b.relationships?(f.forEach(a,function(a){g.InfoTemplate._objEach(b.relationships,function(c,l){var t=new u,d=c.relatedQuery,m;q.push(t);m=a.attributes[c.operLayer.layerObject.objectIdField];d.objectIds=[m];c.operLayer.layerObject.queryRelatedFeatures(d,function(c){var d=[];c[m]&&c[m].features&&(c=c[m].features,f.forEach(c,function(c){var t=[],m,k,z;m=a.attributes;k="relationships/"+l+"/";g.InfoTemplate._objEach(c.attributes,function(a,c){z=k+c;m[z]=a});f.forEach(b,
function(c){t.push(h.substitute(c,g.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(a,b.parsedExpressions,e),g.InfoTemplate._useEmptyStringForNull))});d.push(t)}));t.resolve(d)})})}),r(q).then(function(a){f.forEach(a,function(a){f.forEach(a,function(a){++c;d.push(a)})});console.log(c+" related address features found");k.resolve(d)})):(f.forEach(a,function(a){var c=[];f.forEach(b,function(l){c.push(h.substitute(l,g.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(a,b.parsedExpressions,
e),g.InfoTemplate._useEmptyStringForNull))});d.push(c)}),k.resolve(d));return k};g.InfoTemplate._parseArcadeExpressions=function(a){var g;Array.isArray(a)&&0<a.length&&(g={},f.forEach(a,function(a){g[a.name]=b.parseScript(a.expression)}));return g};g.InfoTemplate._initArcadeContext=function(a,b){var e={vars:{}};e.vars.$feature=k.createFromGraphicLikeObject(a.geometry,a.attributes,b);return e};g.InfoTemplate._combineFeatureAttributesAndExpressionResolutions=function(a,f,e){var h,d;h=n.mixin({},a.attributes);
if(f)for(d in a=g.InfoTemplate._initArcadeContext(a,e),f)e=b.executeScript(f[d],a),h["expression/"+d]=e?e.toString():"";return h};g.InfoTemplate._convertEndParasToEOLs=function(a){var b=a;a=a.match(/<\/p>/gi);f.forEach(a,function(a){b=b.replace(a,"\n")});return b};g.InfoTemplate._convertBreaksToEOLs=function(a){var b=a;a=a.match(/<br\s*\/?>/gi);f.forEach(a,function(a){b=b.replace(a,"\n")});return b};g.InfoTemplate._useEmptyStringForNull=function(a){return a?a:""};g.InfoTemplate._objEach=function(a,
b,e){for(var f in a)a.hasOwnProperty(f)&&b.call(e,a[f],f)};return g})},"widgets/AttributeTable/setting/_build-generate_module":function(){define(["dojo/text!./Setting.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/AttributeTable/setting/Setting.html":'\x3cdiv style\x3d"width:100%;"\x3e\r\n  \x3cdiv class\x3d"instruction"\x3e\r\n    \x3cp\x3e${nls.instruction}\x3c/p\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"check-syncwithlayers" data-dojo-attach-point\x3d"syncWithLayersCheck"\r\n    data-dojo-type\x3d"jimu/dijit/CheckBox" label\x3d"${nls.syncWithLayers}"\x3e\x3c/div\x3e\r\n\r\n  \x3cdiv data-dojo-attach-point\x3d"tableLayerInfos" class\x3d"table-layer-infos"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"table-options jimu-ellipsis"\x3e\r\n    \x3cul\x3e\r\n      \x3cli\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"exportcsv" checked\r\n        data-dojo-type\x3d"jimu/dijit/CheckBox" label\x3d"${nls.exportCSV}"\x3e\x3c/div\x3e\r\n      \x3c/li\x3e\r\n      \x3cli\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"expand" data-dojo-type\x3d"jimu/dijit/CheckBox" label\x3d"${nls.expand}"\x3e\x3c/div\x3e\r\n      \x3c/li\x3e\r\n      \x3cli\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"filterByMapExtent" data-dojo-type\x3d"jimu/dijit/CheckBox" label\x3d"${nls.filterByExtent}"\x3e\x3c/div\x3e\r\n      \x3c/li\x3e\r\n      \x3cli\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"textSelection" data-dojo-type\x3d"jimu/dijit/CheckBox" label\x3d"${nls.allowTextSelection}"\x3e\x3c/div\x3e\r\n      \x3c/li\x3e\r\n    \x3c/ul\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/AttributeTable/setting/css/style.css":".jimu-widget-attributetable-setting{margin:0; padding:0; font-size:14px; width: 100%; height: 100%; position: relative; color: #596679;}.jimu-widget-attributetable-setting .instruction{font-size: 12px; margin-bottom: 10px;}.jimu-widget-attributetable-setting .check-syncwithlayers {margin-bottom: 10px; padding-left: 8px; padding-right: 8px;}.jimu-widget-attributetable-setting .show{width: 120px;}.jimu-widget-attributetable-setting .symbol{width: 200px;}.jimu-widget-attributetable-setting .table-layer-infos{width: 100%; height: 240px;}.jimu-widget-attributetable-setting .table-options ul{list-style-type: none; padding: 0;}.jimu-widget-attributetable-setting .jimu-checkbox{margin-right: 20px;}.jimu-rtl .jimu-widget-attributetable-setting .jimu-checkbox{margin-left: 20px; margin-right: 0;}.jimu-widget-attributetable-setting .jimu-checkbox.jimu-state-disabled {color: #e5e5e5;}.jimu-widget-attributetable-setting .jimu-checkbox.jimu-state-disabled .checkbox{cursor: default;}.jimu-widget-attributetable-setting th.isDescending .jimu-checkbox {display: none;}.jimu-widget-attributetable-setting td.isDescending {text-align: center;}.jimu-widget-attributetable-setting td.isDescending .jimu-checkbox {top: 5px; margin: 0;}.jimu-widget-attributetable-setting td.isDescending .jimu-checkbox .checkbox {background: transparent; background-image: url('images/order_up.svg'); width: 16px; height: 16px; background-repeat: no-repeat; background-position-x: 0;}.jimu-widget-attributetable-setting td.isDescending .jimu-checkbox .checkbox.jimu-icon-checked {background-image: url('images/order_down.svg');}.jimu-rtl .jimu-widget-attributetable-setting td.isDescending .jimu-checkbox .checkbox {-webkit-transform: rotateY(180deg); transform: rotateY(180deg);}.jimu-widget-attributetable-setting .sortField .dijitSelect{height: 20px; background: #fff; margin: 5px 0;}.jimu-widget-attributetable-setting .sortField .dijitSelect .dijitButtonContents{border-right-width: 0;}.jimu-rtl .jimu-widget-attributetable-setting .sortField .dijitSelect .dijitButtonContents{border-left-width: 0;}.jimu-widget-attributetable-setting .sortField .dijitSelect .dijitButtonText{overflow: hidden; text-overflow: ellipsis; width: 90px;}.jimu-widget-attributetable-setting .sortField .dijitSelect .dijitInputField{padding-top: 0; padding-bottom: 0;}.jimu-widget-attributetable-setting .sortField .dijitSelect .dijitArrowButton{background: #fff;}.has-webkit .jimu-simple-table.vertical-scroll .head-section \x3e .table-div{padding-right: 6px;}.jimu-rtl.has-webkit .jimu-simple-table.vertical-scroll .head-section \x3e .table-div{padding-left: 6px;}",
"*now":function(f){f(['dojo/i18n!*preload*widgets/AttributeTable/setting/nls/Setting*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare dijit/_WidgetsInTemplateMixin jimu/BaseWidgetSetting jimu/dijit/SimpleTable dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/Deferred dojo/promise/all dojo/query dijit/registry jimu/dijit/Popup jimu/dijit/Message jimu/dijit/CheckBox jimu/dijit/LoadingShelter ../utils".split(" "),function(f,n,u,r,h,b,k,x,y,w,g,a,q,e,v,d,p){return f([u,n],{baseClass:"jimu-widget-attributetable-setting",currentFieldTable:null,_allLayerFields:null,_layerInfos:null,_tableInfos:null,
_delayedLayerInfos:null,_delayedLayerInfosAfterInit:null,_unSpportQueryCampsite:null,startup:function(){this.inherited(arguments);this.config.layerInfos||(this.config.layerInfos=[]);this._allLayerFields=[];this._layerInfos=[];this._tableInfos=[];this._delayedLayerInfos=[];this._delayedLayerInfosAfterInit=[];this._unSpportQueryCampsite={};this.displayFieldsTable=new r({fields:[{name:"show",title:this.nls.show,width:"auto",type:"checkbox","class":"show"},{name:"label",title:this.nls.label,width:"60%",
type:"text"},{name:"url",title:this.nls.url,type:"text",hidden:!0},{name:"index",title:"index",type:"text",hidden:!0},{name:"sortField",title:this.nls.sortField,type:"dropdown",width:"130"},{name:"isDescending",title:"",width:"40",type:"checkbox","class":"sort-order"},{name:"actions",title:this.nls.actions,type:"actions",width:"20%",actions:["edit"],"class":"symbol"},{name:"showAttachments",title:"",type:"checkbox",hidden:!0}],selectable:!0,autoHeight:!1});this.displayFieldsTable.placeAt(this.tableLayerInfos);
b.setStyle(this.displayFieldsTable.domNode,{height:"100%"});this.shelter=new d({hidden:!0});this.shelter.placeAt(this.domNode.parentNode.parentNode||this.domNode);this.shelter.startup();this.shelter.show();p.readLayerInfosObj(this.map).then(h.hitch(this,function(a){this.own(a.on("layerInfosChanged",h.hitch(this,this.onLayerInfosChanged)));this.own(x(this.displayFieldsTable,"actions-edit",h.hitch(this,this.editFieldsClick)));this.own(x(this.displayFieldsTable,"row-click",h.hitch(this,this._verifiedOnShowClick)));
this.own(x(this.displayFieldsTable,"row-add",h.hitch(this,function(a){this._addTooltipToSortOrderNode(a)})));this.own(x(this.syncWithLayersCheck,"change",h.hitch(this,function(a){this._toggleTableShowOption(a)})));this.setConfig(this.config)}))},editFieldsClick:function(a){var c=g(".action-item-parent",a);if(c&&c.length)if(c=this.displayFieldsTable.getRowData(a),c.show){var b=parseInt(c.index,10);this.shelter.show();this._getLayerFields(b).then(h.hitch(this,function(c){this.openFieldsDialog(a,c,b)}),
h.hitch(this,function(a){console.error(a)})).always(h.hitch(this,function(){this.shelter.hide()}))}else var f=new e({message:this.nls.warning,buttons:[{label:this.nls.ok,onClick:h.hitch(this,function(){f.close()})}]})},_verifiedOnShowClick:function(a){var c=this.displayFieldsTable.getRowData(a),b=parseInt(c.index,10),f=null,f=this.config&&this.config.layerInfos&&0<this.config.layerInfos.length?this.config.layerInfos[b]:this._layerInfos[b],b=-1<this._unSpportQueryCampsite.layerNames.indexOf(f.name||
f.title);c.show&&b&&(new e({message:this.nls.unsupportQueryWarning}),c.show=!1,this.displayFieldsTable.editRow(a,c))},_getLayerFields:function(a){return this._layerInfos[a].getLayerObject().then(h.hitch(this,function(c){var b=this._allLayerFields[a];c=k.map(c.fields,function(a){return{name:a.name,alias:a.alias,show:!0}});c=p.arcade.appendArcadeExpressionsToFields(c,this._layerInfos[a]);p.merge(c,b,"name",function(a,c){h.mixin(a,c)});return c=p.syncOrderWith(c,b,"name")}))},_addTooltipToSortOrderNode:function(c){var b=
g(".sort-order .jimu-checkbox",c)[0];c=a.byNode(b);var e=this.nls,f=function(a){b.title=a?e.sortOrderTooltips.toAscending:e.sortOrderTooltips.toDescending};c&&(this.own(x(c,"change",f)),f(c.checked))},openFieldsDialog:function(a,e,f){var c=!1,d=this._layerInfos[f];(d=d&&d.layerObject)&&(c=d.hasAttachments&&d.objectIdField);var d=b.create("div"),l=this._createFieldsTable(e,f);b.place(l.domNode,d);var g=null;c&&(g=new v({label:this.nls.showAttachments,style:"margin-top:10px;"}),e=this.displayFieldsTable.getRowData(a),
g.setValue(e.showAttachments),g.placeAt(d));this.currentFieldTable=l;e=600;g&&(e=640);var m=new q({titleLabel:this.nls.configureLayerFields,width:640,maxHeight:e,autoHeight:!0,content:d,buttons:[{label:this.nls.ok,onClick:h.hitch(this,function(){this._allLayerFields[f]=l.getData();var c=g?g.getValue():!1;this.displayFieldsTable.editRow(a,{showAttachments:c});m.close();m=null})},{label:this.nls.cancel,classNames:["jimu-btn-vacation"],onClick:h.hitch(this,function(){m.close();m=null})}],onClose:function(){m=
null}});l.startup()},_createFieldsTable:function(a){for(var c=null,b={fields:[{name:"show",title:this.nls.fieldVisibility,type:"checkbox","class":"show",onChange:h.hitch(this,function(a){var b=c.getData();!k.some(b,h.hitch(this,function(a){return a.show}))&&(new e({message:this.nls.fieldCheckWarning}),b=c.getRowData(a))&&(b.show=!0,c.editRow(a,b))})},{name:"name",title:this.nls.fieldName,type:"text"},{name:"alias",title:this.nls.fieldAlias,editable:!0,type:"text"},{name:"actions",title:this.nls.fieldActions,
type:"actions",actions:["up","down"],"class":"symbol"}],selectable:!0,autoHeight:!1,style:{height:"300px",maxHeight:"300px"}},c=new r(b),b=0;b<a.length;b++)a[b].show=void 0===a[b].show?!0:!!a[b].show,c.addRow(a[b]);return c},setConfig:function(a){this.config=a;this.displayFieldsTable.clear();this._allLayerFields=[];this._processTableData().then(h.hitch(this,function(a){this._init(a);this.shelter.hide()}),h.hitch(this,function(a){new e({message:a.message||a})}))},onLayerInfosChanged:function(a,b,e){"added"===
b&&e&&a&&e.getSupportTableInfo().then(h.hitch(this,function(a){a.isSupportedLayer&&(this._layerInfos&&0===this._layerInfos.length?this._delayedLayerInfos.push(e):this._layerInfos&&0<this._layerInfos.length&&!this._getLayerInfoById(e.id)&&(this._delayedLayerInfosAfterInit.push(e),this._processDelayedLayerInfosAfterInit(this._delayedLayerInfosAfterInit)))}))},_processDelayedLayerInfosAfterInit:function(a){for(var c=this._layerInfos.length,b=[],e=0;e<a.length;e++){var f=p.getConfigInfoFromLayerInfo(a[e]),
d={label:f.name||f.title,url:f.layer.url,index:""+(c+e),isDescending:!0,show:f.show};this._allLayerFields.push(f.layer.fields);this._layerInfos.push(a[e]);b.push(this._prepareSortField(d,e))}w(b).then(h.hitch(this,function(a){for(var c=0;c<a.length;c++)this._addRowToDisplayFieldsTable(a[c])}),h.hitch(this,function(a){console.error(a)}))},_processDelayedLayerInfos:function(){0<this._delayedLayerInfos.length&&(k.forEach(this._delayedLayerInfos,h.hitch(this,function(a){this._getLayerInfoById(a.id)||
this._layerInfos.push(a)})),this._delayedLayerInfos=[])},_processTableData:function(){var a=new y;p.readConfigLayerInfosFromMap(this.map,!0,!0).then(h.hitch(this,function(b){this._layerInfos=b;this._processDelayedLayerInfos();p.readSupportTableInfoFromLayerInfos(this._layerInfos).then(h.hitch(this,function(c){this._tableInfos=c;this.config&&this.config.layerInfos&&0<this.config.layerInfos.length?(c=p.getConfigInfosFromLayerInfos(this._layerInfos),p.merge(c,this.config.layerInfos,"id",h.hitch(this,
function(a,c){var b=this._getLayerInfoById(a.id);a.layer.fields=p.arcade.appendArcadeExpressionsToFields(a.layer.fields,b);a.show=c.show;a.showAttachments=c.showAttachments;a.sortField=c.sortField;a.isDescending=c.isDescending;a.layer.url=c.layer.url;h.getObject("layer.fields.length",!1,a)&&h.getObject("layer.fields.length",!1,c)?(p.merge(a.layer.fields,c.layer.fields,"name",function(a,c){h.mixin(a,c)}),a.layer.fields=p.syncOrderWith(a.layer.fields,c.layer.fields,"name")):a.layer.fields=c.layer.fields})),
this.config.layerInfos=c,this._unSpportQueryCampsite.fromConfig=!0,this._unSpportQueryCampsite.layerNames=this._getUnsupportQueryLayerNames(this.config.layerInfos)):(this._unSpportQueryCampsite.fromConfig=!1,this._unSpportQueryCampsite.layerNames=this._getUnsupportQueryLayerNames(this._layerInfos),c=p.getConfigInfosFromLayerInfos(b),c=k.map(c,h.hitch(this,function(a){var c=h.getObject("layer.fields",!1,a),b=this._getLayerInfoById(a.id);c&&(c=p.arcade.appendArcadeExpressionsToFields(a.layer.fields,
b),a.layer.fields=c);return a})));a.resolve(c)}),function(c){console.error(c);a.reject(c)})}),h.hitch(this,function(c){console.error(c);a.reject(c)}));return a},_getUnsupportQueryLayerNames:function(a){var c=[];k.forEach(a,h.hitch(this,function(a){var b=this._getSupportTableInfoById(a.id);b&&!b.isSupportQuery&&c.push(a.name||a.title)}));return c},_init:function(a){for(var c=[],f=[],d=0;d<a.length;d++){var g=a[d].show&&this._getSupportTableInfoById(a[d].id).isSupportQuery,g={label:a[d].name||a[d].title,
url:a[d].layer.url,index:""+d,show:g,sorting:{fields:a[d].layer.fields,selectedField:a[d].sortField},isDescending:a[d].isDescending,showAttachments:!!a[d].showAttachments};this._allLayerFields.push(a[d].layer.fields);f.push(this._prepareSortField(g,d));this._unSpportQueryCampsite.fromConfig&&(g=(g=this._unSpportQueryCampsite.layerNames)&&-1<g.indexOf(a[d].name||a[d].title),a[d].show&&g&&c.push(a[d].name||a[d].title))}w(f).then(h.hitch(this,function(a){for(var c=0;c<a.length;c++)this._addRowToDisplayFieldsTable(a[c])}),
h.hitch(this,function(a){console.error(a)}));this._unSpportQueryCampsite.fromConfig&&0<c.length&&new e({message:this.nls.unsupportQueryLayers+"\x3cbr\x3e\x3cbr\x3e"+c.toString()});this.config.hideExportButton?this.exportcsv.uncheck():this.exportcsv.check();this.config.initiallyExpand?this.expand.check():this.expand.uncheck();this._canUseOpenAtStart()&&(this.openAtStart?this.expand.check():this.expand.uncheck(),this.expand.status=!1,b.addClass(this.expand.domNode,"disable-checkbox"));this.config.filterByMapExtent?
this.filterByMapExtent.check():this.filterByMapExtent.uncheck();this.config.allowTextSelection?this.textSelection.check():this.textSelection.uncheck();this.config.syncWithLayers?this.syncWithLayersCheck.check():this.syncWithLayersCheck.uncheck()},_addRowToDisplayFieldsTable:function(a){this.displayFieldsTable.addRow(a)},_prepareSortField:function(a,b){var c=new y;a.sorting&&a.sorting.fields?(a.sortField=this._prepareSortFieldOptions(a.sorting),c.resolve(a)):this._getLayerFields(b).then(h.hitch(this,
function(b){a.sorting?a.sorting.fields=b:a.sorting={fields:b};a.sortField=this._prepareSortFieldOptions(a.sorting);c.resolve(a)}),h.hitch(this,function(a){console.error(a);c.reject(a)}));return c},_prepareSortFieldOptions:function(a){if(a&&a.fields&&Array.isArray(a.fields))return k.map(a.fields,function(b){var c={value:b.name,label:b.alias};a.selectedField===b.name&&(c.selected=!0);0===b.name.indexOf("expression/")&&(c.disabled=!0);return c})},_canUseOpenAtStart:function(){return this.closeable||
!this.isOnScreen},_getLayerInfoById:function(a){for(var b=0,c=this._layerInfos.length;b<c;b++)if(this._layerInfos[b].id===a)return this._layerInfos[b]},_getSupportTableInfoById:function(a){for(var b=0,c=this._tableInfos.length;b<c;b++)if(this._tableInfos[b].id===a)return this._tableInfos[b]},getConfig:function(){var a=this.displayFieldsTable.getData(),b=[],e=a.length;if(this.config&&this.config.layerInfos&&0<this.config.layerInfos.length)k.forEach(a,h.hitch(this,function(c,e){c=this.config.layerInfos[e];
var d={};d.name=c.name||c.title;d.id=c.id;d.layer={};d.layer.url=a[e].url;d.layer.fields=this._allLayerFields[e];d.show=a[e].show;d.showAttachments=a[e].showAttachments;d.sortField=a[e].sortField;d.isDescending=a[e].isDescending;b.push(d)}));else for(var d=0;d<e;d++){var f={};f.name=this._layerInfos[d].name||this._layerInfos[d].title;f.id=this._layerInfos[d].id;f.layer={};f.layer.url=a[d].url;f.layer.fields=this._allLayerFields[d];f.show=a[d].show;f.showAttachments=a[d].showAttachments;f.sortField=
a[d].sortField;f.isDescending=a[d].isDescending;b.push(f)}this.config.layerInfos=b;this.config.hideExportButton=!this.exportcsv.getValue();this.config.filterByMapExtent=this.filterByMapExtent.getValue();this.config.allowTextSelection=this.textSelection.getValue();this.config.syncWithLayers=this.syncWithLayersCheck.getValue();this._canUseOpenAtStart()||(this.config.initiallyExpand=this.expand.getValue());return this.config},_toggleTableShowOption:function(b){this.displayFieldsTable&&g(".show .jimu-checkbox").forEach(function(c){a.byNode(c).setStatus(!b)})}})});